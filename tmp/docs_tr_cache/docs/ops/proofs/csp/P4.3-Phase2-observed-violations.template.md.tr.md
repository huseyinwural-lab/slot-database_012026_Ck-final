# Kanıt — P4.3 Faz 2 — Gözlemlenen CSP İhlalleri (Allowlist Güncelleme Girdisi)

> Amaç: **CSP Report-Only** döneminde gözlemlenen CSP ihlallerini toplamak/normalize etmek için standart artefakt.
> Çıktı: (a) ihlalleri sayılar ve aksiyonlarla listeleyen, (b) allowlist kararını kaydeden, (c) enforce gate sonucunu sağlayan tek bir dosya.

---

## 1) Meta veriler
- env: `staging` | `prod`
- domain: <fill-me>
- period_start_utc (YYYY-MM-DDTHH:mm:ssZ): <fill-me>
- period_end_utc (YYYY-MM-DDTHH:mm:ssZ): <fill-me>

- CSP modu: `report-only`
- politika kaynağı:
  - dosya: `docs/ops/csp_policy.md`
  - commit/git_sha (veya release etiketi): <fill-me>

- UI sürümü (opsiyonel): <fill-me>
- Backend sürümü (opsiyonel): <fill-me>
- Operatör: <fill-me>
- Gözden geçiren (opsiyonel): <fill-me>

---

## 2) Toplama yöntemi
Bir (veya daha fazlasını) seçin ve yönlendirmeler sağlayın.

- [ ] Tarayıcı konsolu (DevTools)
  - test edilen tarayıcılar: <fill-me>
  - çalıştırılan sayfalar / akışlar: <fill-me>
  - notlar: <fill-me>

- [ ] CSP rapor uç noktası (konfigüre edildiyse)
  - endpoint URL: <fill-me>
  - örnek request id(leri) / correlation id(leri): <fill-me>
  - dışa aktarma yöntemi (JSON dump, sorgu, vb.): <fill-me>

- [ ] Reverse proxy / edge logları
  - kaynak (nginx/ingress/WAF): <fill-me>
  - kullanılan sorgu/filtre: <fill-me>
  - zaman aralığı: <fill-me>

---

## 3) İhlal listesi (normalize tablo)

> Karar verme için önemli olan her benzersiz kombinasyon için bir satır.
> `source-file/line/col` eksikse `-` yazın.

| # | blocked-uri | effective-directive | document-uri (path) | source-file | line | col | sample count | action | rationale |
|---|------------|---------------------|---------------------|------------|------|-----|-------------|--------|-----------|
| 1 | <fill-me>   | <fill-me>           | <fill-me>           | <fill-me>  | <n>  | <n> | <n>         | allowlist / kodu düzelt / yok say | <fill-me> |

---

## 4) Karar kaydı

### 4.1 Allowlist eklemeleri (onaylı)
> `docs/ops/csp_policy.md` içine merge edilecek nihai liste.

- <domain-or-source-1>
- <domain-or-source-2>

### 4.2 Geçici izinler (süre sınırlı)
> Yalnızca kaçınılmazsa kullanın. Son kullanma tarihi içermelidir.

- allowance: <fill-me>
  - reason: <fill-me>
  - expires_utc: <fill-me>

### 4.3 Planlanan düzeltmeler (kod/konfig)
- <kısa düzeltme maddesi>

---

## 5) Enforce gate

### 5.1 Tanım — “kritik ihlal = 0”
Kritik = aşağıdakilerden **herhangi birini** karşılayan herhangi bir ihlal:
- login/auth/session akışlarını bozar
- çekirdek gezinmeyi / routing’i bozar (sidebar, birincil sayfalar)
- UI çalışması için gerekli API bağlantısını bozar (gerekli origin’lere `connect-src` hataları)
- birincil script çalıştırmayı (script-src) veya uygulama bootstrap’ini engeller

### 5.2 Gate sonucu
- gözlemlenen kritik ihlaller: <0|n>
- durum: **PASS** | **FAIL**

Kanıt özeti:
- <1-3 satır>

---

## 6) Notlar / takipler
- <fill-me>