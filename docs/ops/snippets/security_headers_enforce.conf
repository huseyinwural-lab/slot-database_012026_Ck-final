# Nginx security headers (CSP Enforce + HSTS optional) - P4.3
# Rollback: switch include back to report-only (or off).

# Baseline security headers
add_header X-Content-Type-Options "nosniff" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
add_header X-Frame-Options "DENY" always;

# CSP (Enforce)
add_header Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; script-src 'self' 'report-sample'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' https: wss:;" always;

# HSTS (enable only when instructed by rollout)
# Staging example:
# add_header Strict-Transport-Security "max-age=300" always;
# Prod ramp examples:
# add_header Strict-Transport-Security "max-age=300" always;
# add_header Strict-Transport-Security "max-age=3600" always;
# add_header Strict-Transport-Security "max-age=86400" always;
# add_header Strict-Transport-Security "max-age=31536000" always;
# NOTE: preload/includeSubDomains are intentionally NOT enabled by default.
