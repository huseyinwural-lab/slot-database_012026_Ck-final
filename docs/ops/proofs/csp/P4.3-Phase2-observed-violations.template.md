# Proof — P4.3 Phase 2 — Observed CSP Violations (Allowlist Update Input)

> Purpose: Standard artifact to collect/normalize CSP violations observed during **CSP Report-Only** period.
> Output: A single file that (a) lists violations with counts and actions, (b) records the allowlist decision, (c) provides the enforce gate result.

---

## 1) Metadata
- env: `staging` | `prod`
- domain: <fill-me>
- period_start_utc (YYYY-MM-DDTHH:mm:ssZ): <fill-me>
- period_end_utc (YYYY-MM-DDTHH:mm:ssZ): <fill-me>

- CSP mode: `report-only`
- policy source:
  - file: `docs/ops/csp_policy.md`
  - commit/git_sha (or release tag): <fill-me>

- UI version (optional): <fill-me>
- Backend version (optional): <fill-me>
- Operator: <fill-me>
- Reviewer (optional): <fill-me>

---

## 2) Collection method
Select one (or more) and provide pointers.

- [ ] Browser console (DevTools)
  - browsers tested: <fill-me>
  - pages / flows exercised: <fill-me>
  - notes: <fill-me>

- [ ] CSP report endpoint (if configured)
  - endpoint URL: <fill-me>
  - sample request id(s) / correlation id(s): <fill-me>
  - export method (JSON dump, query, etc.): <fill-me>

- [ ] Reverse proxy / edge logs
  - source (nginx/ingress/WAF): <fill-me>
  - query/filter used: <fill-me>
  - time window: <fill-me>

---

## 3) Violation list (normalized table)

> One row per unique combination that matters for decisioning.
> If `source-file/line/col` is missing, write `-`.

| # | blocked-uri | effective-directive | document-uri (path) | source-file | line | col | sample count | action | rationale |
|---|------------|---------------------|---------------------|------------|------|-----|-------------|--------|-----------|
| 1 | <fill-me>   | <fill-me>           | <fill-me>           | <fill-me>  | <n>  | <n> | <n>         | allowlist / fix code / ignore | <fill-me> |

---

## 4) Decision record

### 4.1 Allowlist additions (approved)
> Final list to be merged into `docs/ops/csp_policy.md`.

- <domain-or-source-1>
- <domain-or-source-2>

### 4.2 Temporary allowances (time-boxed)
> Use only if unavoidable. Must include expiry.

- allowance: <fill-me>
  - reason: <fill-me>
  - expires_utc: <fill-me>

### 4.3 Fixes planned (code/config)
- <short fix item>

---

## 5) Enforce gate

### 5.1 Definition — “critical violation = 0”
Critical = any violation that meets **any** of:
- breaks login/auth/session flows
- breaks core navigation / routing (sidebar, primary pages)
- breaks API connectivity required for UI operation (`connect-src` failures to required origins)
- blocks primary script execution (script-src) or app bootstrap

### 5.2 Gate result
- critical violations observed: <0|n>
- status: **PASS** | **FAIL**

Evidence summary:
- <1-3 lines>

---

## 6) Notes / follow-ups
- <fill-me>
